  [1m[35m (25.8ms)[0m  [1m[35mDROP DATABASE IF EXISTS "cloudwalk_risk_api_test"[0m
  [1m[35m (59.8ms)[0m  [1m[35mCREATE DATABASE "cloudwalk_risk_api_test" ENCODING = 'unicode'[0m
  [1m[35mSQL (1.2ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "transactions" CASCADE[0m
  [1m[35m (8.1ms)[0m  [1m[35mCREATE TABLE "transactions" ("id" bigserial primary key, "transaction_id" integer, "merchant_id" integer, "user_id" integer, "card_number" character varying, "transaction_date" timestamp(6), "transaction_amount" float, "device_id" integer, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (4.4ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20231107182255)[0m
  [1m[35m (5.2ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.9ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2023-11-07 18:23:24.511011', '2023-11-07 18:23:24.511015') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.1ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', '0ecc125d9c609815f46fc8056cc4f65cbdf0f417', '2023-11-07 18:23:24.514885', '2023-11-07 18:23:24.514889') RETURNING "key"[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "transactions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[31mDELETE FROM "transactions";
INSERT INTO "transactions" ("id", "transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "created_at", "updated_at") VALUES (980190962, 1, 1, 1, 'MyString', '2023-11-07 15:22:55', 1.5, 1, '2023-11-07 18:23:24.662631', '2023-11-07 18:23:24.662631'), (298486374, 1, 1, 1, 'MyString', '2023-11-07 15:22:55', 1.5, 1, '2023-11-07 18:23:24.662631', '2023-11-07 18:23:24.662631')[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (6.9ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------
TransactionsControllerTest: test_should_update_transaction
----------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
Started PATCH "/transactions/980190962" for 127.0.0.1 at 2023-11-07 15:23:24 -0300
Processing by TransactionsController#update as JSON
  Parameters: {"transaction"=>{"card_number"=>"MyString", "device_id"=>1, "merchant_id"=>1, "transaction_amount"=>1.5, "transaction_date"=>"2023-11-07T15:22:55.000Z", "transaction_id"=>1, "user_id"=>1}, "id"=>"980190962"}
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
Completed 200 OK in 25ms (Views: 0.4ms | ActiveRecord: 0.4ms | Allocations: 5528)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
TransactionsControllerTest: test_should_destroy_transaction
-----------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
Started DELETE "/transactions/980190962" for 127.0.0.1 at 2023-11-07 15:23:24 -0300
Processing by TransactionsController#destroy as JSON
  Parameters: {"id"=>"980190962", "transaction"=>{}}
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Destroy (0.7ms)[0m  [1m[31mDELETE FROM "transactions" WHERE "transactions"."id" = $1[0m  [["id", 980190962]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 204 No Content in 3ms (ActiveRecord: 1.4ms | Allocations: 561)
  [1m[36mTransaction Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
TransactionsControllerTest: test_should_show_transaction
--------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
Started GET "/transactions/980190962" for 127.0.0.1 at 2023-11-07 15:23:24 -0300
Processing by TransactionsController#show as JSON
  Parameters: {"id"=>"980190962", "transaction"=>{}}
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.3ms | ActiveRecord: 0.3ms | Allocations: 272)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------
TransactionsControllerTest: test_should_create_transaction
----------------------------------------------------------
  [1m[36mTransaction Load (0.2ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
Started POST "/transactions" for 127.0.0.1 at 2023-11-07 15:23:24 -0300
Processing by TransactionsController#create as JSON
  Parameters: {"transaction"=>{"card_number"=>"MyString", "device_id"=>1, "merchant_id"=>1, "transaction_amount"=>1.5, "transaction_date"=>"2023-11-07T15:22:55.000Z", "transaction_id"=>1, "user_id"=>1}}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Create (0.8ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["transaction_id", 1], ["merchant_id", 1], ["user_id", 1], ["card_number", "MyString"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["created_at", "2023-11-07 18:23:24.978642"], ["updated_at", "2023-11-07 18:23:24.978642"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 4ms (Views: 0.6ms | ActiveRecord: 1.2ms | Allocations: 1005)
  [1m[36mTransaction Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------
TransactionsControllerTest: test_should_get_index
-------------------------------------------------
  [1m[36mTransaction Load (0.2ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
Started GET "/transactions" for 127.0.0.1 at 2023-11-07 15:23:24 -0300
Processing by TransactionsController#index as JSON
  Parameters: {"transaction"=>{}}
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions"[0m
Completed 200 OK in 2ms (Views: 1.5ms | ActiveRecord: 0.4ms | Allocations: 351)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[31mDELETE FROM "transactions";
INSERT INTO "transactions" ("id", "transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "created_at", "updated_at") VALUES (980190962, 1, 1, 1, 'MyString', '2023-11-07 15:22:55', 1.5, 1, '2023-11-07 20:35:58.913423', '2023-11-07 20:35:58.913423'), (298486374, 1, 1, 1, 'MyString', '2023-11-07 15:22:55', 1.5, 1, '2023-11-07 20:35:58.913423', '2023-11-07 20:35:58.913423')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (4.2ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------
TransactionsControllerTest: test_should_get_index
-------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
Started GET "/transactions" for 127.0.0.1 at 2023-11-07 17:35:59 -0300
Processing by TransactionsController#index as JSON
  Parameters: {"transaction"=>{}}
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions"[0m
Completed 200 OK in 12ms (Views: 1.7ms | ActiveRecord: 0.4ms | Allocations: 3501)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
TransactionsControllerTest: test_should_destroy_transaction
-----------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
Started DELETE "/transactions/980190962" for 127.0.0.1 at 2023-11-07 17:35:59 -0300
Processing by TransactionsController#destroy as JSON
  Parameters: {"id"=>"980190962", "transaction"=>{}}
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Destroy (0.7ms)[0m  [1m[31mDELETE FROM "transactions" WHERE "transactions"."id" = $1[0m  [["id", 980190962]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 204 No Content in 4ms (ActiveRecord: 1.3ms | Allocations: 842)
  [1m[36mTransaction Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
TransactionsControllerTest: test_should_show_transaction
--------------------------------------------------------
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
Started GET "/transactions/980190962" for 127.0.0.1 at 2023-11-07 17:35:59 -0300
Processing by TransactionsController#show as JSON
  Parameters: {"id"=>"980190962", "transaction"=>{}}
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.3ms | ActiveRecord: 0.3ms | Allocations: 277)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------
TransactionsControllerTest: test_should_update_transaction
----------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
Started PATCH "/transactions/980190962" for 127.0.0.1 at 2023-11-07 17:35:59 -0300
Processing by TransactionsController#update as JSON
  Parameters: {"transaction"=>{"card_number"=>"MyString", "device_id"=>1, "merchant_id"=>1, "transaction_amount"=>1.5, "transaction_date"=>"2023-11-07T15:22:55.000Z", "transaction_id"=>1, "user_id"=>1}, "id"=>"980190962"}
  [1m[36mTransaction Load (0.2ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 AND "transactions"."id" != $2 LIMIT $3[0m  [["transaction_id", 1], ["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Entity in 16ms (Views: 6.5ms | ActiveRecord: 3.5ms | Allocations: 3875)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------
TransactionsControllerTest: test_should_create_transaction
----------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
Started POST "/transactions" for 127.0.0.1 at 2023-11-07 17:35:59 -0300
Processing by TransactionsController#create as JSON
  Parameters: {"transaction"=>{"card_number"=>"MyString", "device_id"=>1, "merchant_id"=>1, "transaction_amount"=>1.5, "transaction_date"=>"2023-11-07T15:22:55.000Z", "transaction_id"=>1, "user_id"=>1}}
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (1.2ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Entity in 5ms (Views: 0.5ms | ActiveRecord: 1.8ms | Allocations: 954)
  [1m[36mTransaction Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (20.5ms)[0m  [1m[35mDROP DATABASE IF EXISTS "cloudwalk_risk_api_test"[0m
  [1m[35m (62.2ms)[0m  [1m[35mCREATE DATABASE "cloudwalk_risk_api_test" ENCODING = 'unicode'[0m
  [1m[35mSQL (0.5ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "transactions" CASCADE[0m
  [1m[35m (7.6ms)[0m  [1m[35mCREATE TABLE "transactions" ("id" bigserial primary key, "transaction_id" integer, "merchant_id" integer, "user_id" integer, "card_number" character varying, "transaction_date" timestamp(6), "transaction_amount" float, "device_id" integer, "has_cbk" boolean DEFAULT FALSE, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (3.3ms)[0m  [1m[35mCREATE INDEX "index_transactions_on_card_number" ON "transactions" ("card_number")[0m
  [1m[35m (2.7ms)[0m  [1m[35mCREATE INDEX "index_transactions_on_merchant_id" ON "transactions" ("merchant_id")[0m
  [1m[35m (2.6ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_transactions_on_transaction_id" ON "transactions" ("transaction_id")[0m
  [1m[35m (2.1ms)[0m  [1m[35mCREATE INDEX "index_transactions_on_user_id" ON "transactions" ("user_id")[0m
  [1m[35m (4.7ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20231107182255)[0m
  [1m[35m (3.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.8ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.8ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2023-11-07 20:46:35.960305', '2023-11-07 20:46:35.960309') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.6ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', '29374218c26ba8df2d4e1d9094dfe953cc1c4112', '2023-11-07 20:46:35.963451', '2023-11-07 20:46:35.963454') RETURNING "key"[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "transactions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.8ms)[0m  [1m[31mDELETE FROM "transactions";
INSERT INTO "transactions" ("id", "transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES (980190962, 1, 1, 1, '434505******9116', '2023-11-07 15:22:55', 1.5, 1, DEFAULT, '2023-11-07 20:53:10.904328', '2023-11-07 20:53:10.904328'), (298486374, 2, 1, 1, '444456******4210', '2023-11-07 15:22:55', 1.5, 1, DEFAULT, '2023-11-07 20:53:10.904328', '2023-11-07 20:53:10.904328')[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "transactions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.5ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------
TransactionsControllerTest: test_should_create_transaction
----------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
Started POST "/transactions" for 127.0.0.1 at 2023-11-07 17:53:11 -0300
Processing by TransactionsController#create as JSON
  Parameters: {"transaction"=>{"card_number"=>"434505******9116", "device_id"=>1, "merchant_id"=>1, "transaction_amount"=>1.5, "transaction_date"=>"2023-11-07T15:22:55.000Z", "transaction_id"=>1, "user_id"=>1}}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Entity in 15ms (Views: 2.5ms | ActiveRecord: 1.1ms | Allocations: 5751)
  [1m[36mTransaction Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------
TransactionsControllerTest: test_should_update_transaction
----------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
Started PATCH "/transactions/980190962" for 127.0.0.1 at 2023-11-07 17:53:11 -0300
Processing by TransactionsController#update as JSON
  Parameters: {"transaction"=>{"card_number"=>"434505******9116", "device_id"=>1, "merchant_id"=>1, "transaction_amount"=>1.5, "transaction_date"=>"2023-11-07T15:22:55.000Z", "transaction_id"=>1, "user_id"=>1}, "id"=>"980190962"}
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Entity in 7ms (Views: 0.4ms | ActiveRecord: 4.2ms | Allocations: 1454)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------
TransactionsControllerTest: test_should_get_index
-------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
Started GET "/transactions" for 127.0.0.1 at 2023-11-07 17:53:11 -0300
Processing by TransactionsController#index as JSON
  Parameters: {"transaction"=>{}}
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions"[0m
Completed 200 OK in 1ms (Views: 0.9ms | ActiveRecord: 0.3ms | Allocations: 387)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
TransactionsControllerTest: test_should_show_transaction
--------------------------------------------------------
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
Started GET "/transactions/980190962" for 127.0.0.1 at 2023-11-07 17:53:11 -0300
Processing by TransactionsController#show as JSON
  Parameters: {"id"=>"980190962", "transaction"=>{}}
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.3ms | ActiveRecord: 0.3ms | Allocations: 281)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
TransactionsControllerTest: test_should_destroy_transaction
-----------------------------------------------------------
  [1m[36mTransaction Load (0.2ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
Started DELETE "/transactions/980190962" for 127.0.0.1 at 2023-11-07 17:53:11 -0300
Processing by TransactionsController#destroy as JSON
  Parameters: {"id"=>"980190962", "transaction"=>{}}
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Destroy (0.8ms)[0m  [1m[31mDELETE FROM "transactions" WHERE "transactions"."id" = $1[0m  [["id", 980190962]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 204 No Content in 3ms (ActiveRecord: 1.4ms | Allocations: 573)
  [1m[36mTransaction Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[31mDELETE FROM "transactions";
INSERT INTO "transactions" ("id", "transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES (980190962, 1, 1, 1, '434505******9116', '2023-11-07 15:22:55', 1.5, 1, DEFAULT, '2023-11-07 22:58:03.423622', '2023-11-07 22:58:03.423622'), (298486374, 2, 1, 1, '444456******4210', '2023-11-07 15:22:55', 1.5, 1, DEFAULT, '2023-11-07 22:58:03.423622', '2023-11-07 22:58:03.423622')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "transactions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (4.9ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
TransactionTest: test_should_persist_a_valid_transaction
--------------------------------------------------------
  [1m[36mTransaction Load (0.5ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
TransactionTest - test_should_persist_a_valid_transaction: ArgumentError raised.
If you expected this exception, use `assert_raises` as near to the code that raises as possible.
Other block based assertions (e.g. `assert_difference`) can be used, as long as `assert_raises` is inside their block.

  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[31mDELETE FROM "transactions";
INSERT INTO "transactions" ("id", "transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES (980190962, 1, 1, 1, '434505******9116', '2023-11-07 15:22:55', 1.5, 1, DEFAULT, '2023-11-07 23:02:01.964834', '2023-11-07 23:02:01.964834'), (298486374, 2, 1, 1, '444456******4210', '2023-11-07 15:22:55', 1.5, 1, DEFAULT, '2023-11-07 23:02:01.964834', '2023-11-07 23:02:01.964834')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (4.3ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
TransactionTest: test_should_persist_a_valid_transaction
--------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
TransactionTest - test_should_persist_a_valid_transaction: ActiveRecord::RecordInvalid raised.
If you expected this exception, use `assert_raises` as near to the code that raises as possible.
Other block based assertions (e.g. `assert_difference`) can be used, as long as `assert_raises` is inside their block.

  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.6ms)[0m  [1m[31mDELETE FROM "transactions";
INSERT INTO "transactions" ("id", "transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES (980190962, 1, 1, 1, '434505******9116', '2023-11-07 15:22:55', 1.5, 1, DEFAULT, '2023-11-07 23:02:28.986548', '2023-11-07 23:02:28.986548'), (298486374, 2, 1, 1, '444456******4210', '2023-11-07 15:22:55', 1.5, 1, DEFAULT, '2023-11-07 23:02:28.986548', '2023-11-07 23:02:28.986548')[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "transactions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.4ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
TransactionTest: test_should_persist_a_valid_transaction
--------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
TransactionTest - test_should_persist_a_valid_transaction: ActiveRecord::RecordInvalid raised.
If you expected this exception, use `assert_raises` as near to the code that raises as possible.
Other block based assertions (e.g. `assert_difference`) can be used, as long as `assert_raises` is inside their block.

  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (25.0ms)[0m  [1m[35mDROP DATABASE IF EXISTS "cloudwalk_risk_api_test"[0m
  [1m[35m (63.7ms)[0m  [1m[35mCREATE DATABASE "cloudwalk_risk_api_test" ENCODING = 'unicode'[0m
  [1m[35mSQL (0.7ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "transactions" CASCADE[0m
  [1m[35m (9.2ms)[0m  [1m[35mCREATE TABLE "transactions" ("id" bigserial primary key, "transaction_id" integer, "merchant_id" integer, "user_id" integer, "card_number" character varying, "transaction_date" timestamp(6), "transaction_amount" float, "device_id" integer, "has_cbk" boolean, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (2.7ms)[0m  [1m[35mCREATE INDEX "index_transactions_on_card_number" ON "transactions" ("card_number")[0m
  [1m[35m (2.5ms)[0m  [1m[35mCREATE INDEX "index_transactions_on_merchant_id" ON "transactions" ("merchant_id")[0m
  [1m[35m (2.4ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_transactions_on_transaction_id" ON "transactions" ("transaction_id")[0m
  [1m[35m (2.3ms)[0m  [1m[35mCREATE INDEX "index_transactions_on_user_id" ON "transactions" ("user_id")[0m
  [1m[35m (4.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20231107182255)[0m
  [1m[35m (4.1ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.9ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.9ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2023-11-07 23:07:15.409542', '2023-11-07 23:07:15.409545') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.7ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', 'fb4fd35aaa57070f0afe1194309b105b0d68f51b', '2023-11-07 23:07:15.412895', '2023-11-07 23:07:15.412898') RETURNING "key"[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "transactions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[31mDELETE FROM "transactions";
INSERT INTO "transactions" ("id", "transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES (980190962, 1, 1, 1, '434505******9116', '2023-11-07 15:22:55', 1.5, 1, DEFAULT, '2023-11-07 23:07:15.508357', '2023-11-07 23:07:15.508357'), (298486374, 2, 1, 1, '444456******4210', '2023-11-07 15:22:55', 1.5, 1, DEFAULT, '2023-11-07 23:07:15.508357', '2023-11-07 23:07:15.508357')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.6ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
TransactionTest: test_should_persist_a_valid_transaction
--------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
TransactionTest - test_should_persist_a_valid_transaction: ActiveRecord::RecordInvalid raised.
If you expected this exception, use `assert_raises` as near to the code that raises as possible.
Other block based assertions (e.g. `assert_difference`) can be used, as long as `assert_raises` is inside their block.

  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[31mDELETE FROM "transactions";
INSERT INTO "transactions" ("id", "transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES (980190962, 1, 1, 1, '434505******9116', '2023-11-07 15:22:55', 1.5, 1, DEFAULT, '2023-11-07 23:08:06.389936', '2023-11-07 23:08:06.389936'), (298486374, 2, 1, 1, '444456******4210', '2023-11-07 15:22:55', 1.5, 1, DEFAULT, '2023-11-07 23:08:06.389936', '2023-11-07 23:08:06.389936')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.4ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
TransactionTest: test_should_persist_a_valid_transaction
--------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 3], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", true], ["created_at", "2023-11-07 23:08:06.452866"], ["updated_at", "2023-11-07 23:08:06.452866"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTransaction Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[31mDELETE FROM "transactions";
INSERT INTO "transactions" ("id", "transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES (980190962, 1, 1, 1, '434505******9116', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-07 23:08:51.713815', '2023-11-07 23:08:51.713815'), (298486374, 2, 1, 1, '444456******4210', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-07 23:08:51.713815', '2023-11-07 23:08:51.713815')[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.4ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
TransactionTest: test_should_persist_a_valid_transaction
--------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
TransactionTest - test_should_persist_a_valid_transaction: ActiveRecord::RecordInvalid raised.
If you expected this exception, use `assert_raises` as near to the code that raises as possible.
Other block based assertions (e.g. `assert_difference`) can be used, as long as `assert_raises` is inside their block.

  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[31mDELETE FROM "transactions";
INSERT INTO "transactions" ("id", "transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES (980190962, 1, 1, 1, '434505******9116', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-07 23:13:00.462906', '2023-11-07 23:13:00.462906'), (298486374, 2, 1, 1, '444456******4210', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-07 23:13:00.462906', '2023-11-07 23:13:00.462906')[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (5.0ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
TransactionTest: test_should_persist_a_valid_transaction
--------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 3], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", true], ["created_at", "2023-11-07 23:13:00.533947"], ["updated_at", "2023-11-07 23:13:00.533947"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTransaction Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[31mDELETE FROM "transactions";
INSERT INTO "transactions" ("id", "transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES (980190962, 1, 1, 1, '434505******9116', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-07 23:15:14.455088', '2023-11-07 23:15:14.455088'), (298486374, 2, 1, 1, '444456******4210', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-07 23:15:14.455088', '2023-11-07 23:15:14.455088')[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.4ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
TransactionTest: test_should_persist_a_valid_transaction
--------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.5ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 3], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:15:14.539626"], ["updated_at", "2023-11-07 23:15:14.539626"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTransaction Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------
TransactionTest: test_should_persist_a_invalid_transaction_(without_`transaction_id`)
-------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
TransactionTest - test_should_persist_a_invalid_transaction_(without_`transaction_id`): ActiveRecord::RecordInvalid raised.
If you expected this exception, use `assert_raises` as near to the code that raises as possible.
Other block based assertions (e.g. `assert_difference`) can be used, as long as `assert_raises` is inside their block.

  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[31mDELETE FROM "transactions";
INSERT INTO "transactions" ("id", "transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES (980190962, 1, 1, 1, '434505******9116', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-07 23:16:23.541829', '2023-11-07 23:16:23.541829'), (298486374, 2, 1, 1, '444456******4210', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-07 23:16:23.541829', '2023-11-07 23:16:23.541829')[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.4ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
TransactionTest: test_should_persist_a_valid_transaction
--------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 3], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:16:23.603165"], ["updated_at", "2023-11-07 23:16:23.603165"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTransaction Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------
TransactionTest: test_should_persist_a_invalid_transaction_(without_`transaction_id`)
-------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mCACHE Transaction Count (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[31mDELETE FROM "transactions";
INSERT INTO "transactions" ("id", "transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES (980190962, 1, 1, 1, '434505******9116', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-07 23:18:26.124016', '2023-11-07 23:18:26.124016'), (298486374, 2, 1, 1, '444456******4210', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-07 23:18:26.124016', '2023-11-07 23:18:26.124016')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (4.4ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
TransactionTest: test_should_persist_a_valid_transaction
--------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 3], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:18:26.188989"], ["updated_at", "2023-11-07 23:18:26.188989"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTransaction Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(without_required_attribute)
-------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mCACHE Transaction Count (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(with_future_transaction_date)
---------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mCACHE Transaction Count (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[31mDELETE FROM "transactions";
INSERT INTO "transactions" ("id", "transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES (980190962, 1, 1, 1, '434505******9116', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-07 23:20:44.359033', '2023-11-07 23:20:44.359033'), (298486374, 2, 1, 1, '444456******4210', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-07 23:20:44.359033', '2023-11-07 23:20:44.359033')[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.3ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(without_required_attribute)
-------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mCACHE Transaction Count (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(with_future_transaction_date)
---------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mCACHE Transaction Count (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
TransactionTest: test_should_persist_a_valid_transaction
--------------------------------------------------------
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.5ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 3], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:20:44.444779"], ["updated_at", "2023-11-07 23:20:44.444779"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTransaction Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(with_negative_amount)
-------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mCACHE Transaction Count (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[31mDELETE FROM "transactions";
INSERT INTO "transactions" ("id", "transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES (980190962, 1, 1, 1, '434505******9116', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-07 23:21:33.585658', '2023-11-07 23:21:33.585658'), (298486374, 2, 1, 1, '444456******4210', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-07 23:21:33.585658', '2023-11-07 23:21:33.585658')[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.2ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(without_required_attribute)
-------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mCACHE Transaction Count (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
TransactionTest: test_should_persist_a_valid_transaction
--------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 3], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:21:33.661862"], ["updated_at", "2023-11-07 23:21:33.661862"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTransaction Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(with_zero_amount)
---------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mCACHE Transaction Count (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(with_negative_amount)
-------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mCACHE Transaction Count (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(with_future_transaction_date)
---------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mCACHE Transaction Count (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[31mDELETE FROM "transactions";
INSERT INTO "transactions" ("id", "transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES (980190962, 1, 1, 1, '434505******9116', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-07 23:23:15.417751', '2023-11-07 23:23:15.417751'), (298486374, 2, 1, 1, '444456******4210', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-07 23:23:15.417751', '2023-11-07 23:23:15.417751')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "transactions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.5ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(with_negative_amount)
-------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[36mTransaction Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(without_a_required_attribute)
---------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mCACHE Transaction Count (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
TransactionTest: test_should_persist_a_valid_transaction
--------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.5ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 3], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:23:15.511533"], ["updated_at", "2023-11-07 23:23:15.511533"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTransaction Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(with_future_transaction_date)
---------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[36mTransaction Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(with_zero_amount)
---------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[36mTransaction Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[31mDELETE FROM "transactions";
INSERT INTO "transactions" ("id", "transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES (980190962, 1, 1, 1, '434505******9116', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-07 23:24:59.165627', '2023-11-07 23:24:59.165627'), (298486374, 2, 1, 1, '444456******4210', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-07 23:24:59.165627', '2023-11-07 23:24:59.165627')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.6ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(with_negative_amount)
-------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[36mTransaction Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(with_zero_amount)
---------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[36mTransaction Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(with_future_transaction_date)
---------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[36mTransaction Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
TransactionTest: test_should_persist_a_valid_transaction
--------------------------------------------------------
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 3], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:24:59.257442"], ["updated_at", "2023-11-07 23:24:59.257442"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTransaction Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
TransactionTest: test_should_set_the_has_cbk_after_creation
-----------------------------------------------------------
  [1m[36mTransaction Load (0.5ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 3], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:24:59.264390"], ["updated_at", "2023-11-07 23:24:59.264390"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(without_a_required_attribute)
---------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.7ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mCACHE Transaction Count (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[31mDELETE FROM "transactions";
INSERT INTO "transactions" ("id", "transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES (980190962, 1, 1, 1, '434505******9116', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-07 23:29:14.420198', '2023-11-07 23:29:14.420198'), (298486374, 2, 1, 1, '444456******4210', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-07 23:29:14.420198', '2023-11-07 23:29:14.420198')[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "transactions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.4ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
TransactionTest: test_should_persist_a_valid_transaction
--------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 3], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:29:14.481900"], ["updated_at", "2023-11-07 23:29:14.481900"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
TransactionTest: test_should_set_the_has_cbk_after_creation
-----------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 3], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:29:14.487860"], ["updated_at", "2023-11-07 23:29:14.487860"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[31mDELETE FROM "transactions";
INSERT INTO "transactions" ("id", "transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES (980190962, 1, 1, 1, '434505******9116', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-07 23:31:08.493852', '2023-11-07 23:31:08.493852'), (298486374, 2, 1, 1, '444456******4210', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-07 23:31:08.493852', '2023-11-07 23:31:08.493852')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (5.1ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
TransactionTest: test_should_set_the_has_cbk_after_creation
-----------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.5ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 3], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:31:08.563942"], ["updated_at", "2023-11-07 23:31:08.563942"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(without_a_required_attribute)
---------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
TransactionTest: test_should_persist_a_valid_transaction
--------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 3], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:31:08.572799"], ["updated_at", "2023-11-07 23:31:08.572799"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[31mDELETE FROM "transactions";
INSERT INTO "transactions" ("id", "transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES (980190962, 1, 1, 1, '434505******9116', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-07 23:32:06.465448', '2023-11-07 23:32:06.465448'), (298486374, 2, 1, 1, '444456******4210', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-07 23:32:06.465448', '2023-11-07 23:32:06.465448')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (5.2ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
TransactionTest: test_should_persist_a_valid_transaction
--------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.5ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 3], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:32:06.538422"], ["updated_at", "2023-11-07 23:32:06.538422"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(without_a_required_attribute)
---------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
TransactionTest: test_should_set_the_has_cbk_after_creation
-----------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 3], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:32:06.547938"], ["updated_at", "2023-11-07 23:32:06.547938"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[31mDELETE FROM "transactions";
INSERT INTO "transactions" ("id", "transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES (980190962, 1, 1, 1, '434505******9116', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-07 23:34:39.704688', '2023-11-07 23:34:39.704688'), (298486374, 2, 1, 1, '444456******4210', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-07 23:34:39.704688', '2023-11-07 23:34:39.704688')[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "transactions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.5ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
TransactionTest: test_should_persist_a_valid_transaction
--------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.6ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 3], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:34:39.779841"], ["updated_at", "2023-11-07 23:34:39.779841"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(without_a_required_attribute)
---------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
TransactionTest: test_should_set_the_has_cbk_after_creation
-----------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 3], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:34:39.789053"], ["updated_at", "2023-11-07 23:34:39.789053"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(without_duplicated_transaction_ID)
--------------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.5ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 3], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:34:39.795648"], ["updated_at", "2023-11-07 23:34:39.795648"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[31mDELETE FROM "transactions";
INSERT INTO "transactions" ("id", "transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES (980190962, 1, 1, 1, '434505******9116', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-07 23:36:46.545646', '2023-11-07 23:36:46.545646'), (298486374, 2, 1, 1, '444456******4210', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-07 23:36:46.545646', '2023-11-07 23:36:46.545646')[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.8ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
TransactionTest: test_should_persist_a_valid_transaction
--------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 3], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:36:46.612129"], ["updated_at", "2023-11-07 23:36:46.612129"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(with_future_transaction_date)
---------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(without_a_required_attribute)
---------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(without_duplicated_transaction_ID)
--------------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.5ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 3], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:36:46.627560"], ["updated_at", "2023-11-07 23:36:46.627560"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
TransactionTest: test_should_set_the_has_cbk_after_creation
-----------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.5ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 3], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:36:46.645005"], ["updated_at", "2023-11-07 23:36:46.645005"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[31mDELETE FROM "transactions";
INSERT INTO "transactions" ("id", "transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES (980190962, 1, 1, 1, '434505******9116', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-07 23:37:29.524285', '2023-11-07 23:37:29.524285'), (298486374, 2, 1, 1, '444456******4210', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-07 23:37:29.524285', '2023-11-07 23:37:29.524285')[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.6ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
TransactionTest: test_should_set_the_has_cbk_after_creation
-----------------------------------------------------------
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 3], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:37:29.590489"], ["updated_at", "2023-11-07 23:37:29.590489"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(without_duplicated_transaction_ID)
--------------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 3], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:37:29.596248"], ["updated_at", "2023-11-07 23:37:29.596248"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(with_future_transaction_date)
---------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(with_zero_amount)
---------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(without_a_required_attribute)
---------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
TransactionTest: test_should_persist_a_valid_transaction
--------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 3], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:37:29.632718"], ["updated_at", "2023-11-07 23:37:29.632718"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[31mDELETE FROM "transactions";
INSERT INTO "transactions" ("id", "transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES (980190962, 1, 1, 1, '434505******9116', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-07 23:38:05.062467', '2023-11-07 23:38:05.062467'), (298486374, 2, 1, 1, '444456******4210', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-07 23:38:05.062467', '2023-11-07 23:38:05.062467')[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "transactions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.6ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(with_future_transaction_date)
---------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
TransactionTest: test_should_set_the_has_cbk_after_creation
-----------------------------------------------------------
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 3], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:38:05.136409"], ["updated_at", "2023-11-07 23:38:05.136409"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(without_a_required_attribute)
---------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(without_duplicated_transaction_ID)
--------------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.6ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 3], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:38:05.145366"], ["updated_at", "2023-11-07 23:38:05.145366"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
TransactionTest: test_should_persist_a_valid_transaction
--------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.5ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 3], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:38:05.152377"], ["updated_at", "2023-11-07 23:38:05.152377"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(with_zero_amount)
---------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[31mDELETE FROM "transactions";
INSERT INTO "transactions" ("id", "transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES (980190962, 1, 1, 1, '434505******9116', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-07 23:38:29.817586', '2023-11-07 23:38:29.817586'), (298486374, 2, 1, 1, '444456******4210', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-07 23:38:29.817586', '2023-11-07 23:38:29.817586')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (4.3ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(without_duplicated_transaction_ID)
--------------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 3], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:38:29.880130"], ["updated_at", "2023-11-07 23:38:29.880130"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
TransactionTest: test_should_set_the_has_cbk_after_creation
-----------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 3], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:38:29.887813"], ["updated_at", "2023-11-07 23:38:29.887813"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
TransactionTest: test_should_persist_a_valid_transaction
--------------------------------------------------------
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (3.3ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 3], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:38:29.900279"], ["updated_at", "2023-11-07 23:38:29.900279"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(without_a_required_attribute)
---------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(with_future_transaction_date)
---------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(with_zero_amount)
---------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[31mDELETE FROM "transactions";
INSERT INTO "transactions" ("id", "transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES (980190962, 1, 1, 1, '434505******9116', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-07 23:38:52.395988', '2023-11-07 23:38:52.395988'), (298486374, 2, 1, 1, '444456******4210', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-07 23:38:52.395988', '2023-11-07 23:38:52.395988')[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.5ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(without_a_required_attribute)
---------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.6ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(with_zero_amount)
---------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
TransactionTest: test_should_set_the_has_cbk_after_creation
-----------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 3], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:38:52.474416"], ["updated_at", "2023-11-07 23:38:52.474416"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(without_duplicated_transaction_ID)
--------------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (1.3ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.5ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 3], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:38:52.481365"], ["updated_at", "2023-11-07 23:38:52.481365"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(with_future_transaction_date)
---------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
TransactionTest: test_should_persist_a_valid_transaction
--------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.7ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 3], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:38:52.491981"], ["updated_at", "2023-11-07 23:38:52.491981"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[31mDELETE FROM "transactions";
INSERT INTO "transactions" ("id", "transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES (980190962, 1, 1, 1, '434505******9116', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-07 23:39:29.889923', '2023-11-07 23:39:29.889923'), (298486374, 2, 1, 1, '444456******4210', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-07 23:39:29.889923', '2023-11-07 23:39:29.889923')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (4.0ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(with_negative_amount)
-------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
TransactionTest: test_should_set_the_has_cbk_after_creation
-----------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 3], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:39:29.965597"], ["updated_at", "2023-11-07 23:39:29.965597"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(with_zero_amount)
---------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.2ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(without_duplicated_transaction_ID)
--------------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (1.2ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.5ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 3], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:39:29.975554"], ["updated_at", "2023-11-07 23:39:29.975554"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(with_future_transaction_date)
---------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(without_a_required_attribute)
---------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
TransactionTest: test_should_persist_a_valid_transaction
--------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.8ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 3], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:39:29.989378"], ["updated_at", "2023-11-07 23:39:29.989378"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[31mDELETE FROM "transactions";
INSERT INTO "transactions" ("id", "transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES (980190962, 1, 1, 1, '434505******9116', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-07 23:40:07.722831', '2023-11-07 23:40:07.722831'), (298486374, 2, 1, 1, '444456******4210', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-07 23:40:07.722831', '2023-11-07 23:40:07.722831')[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.5ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
TransactionTest: test_should_set_the_has_cbk_after_creation
-----------------------------------------------------------
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 3], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:40:07.782399"], ["updated_at", "2023-11-07 23:40:07.782399"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(without_a_required_attribute)
---------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(with_negative_amount)
-------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(without_duplicated_transaction_ID)
--------------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 3], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:40:07.801317"], ["updated_at", "2023-11-07 23:40:07.801317"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(with_future_transaction_date)
---------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
TransactionTest: test_should_persist_a_valid_transaction
--------------------------------------------------------
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (1.1ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.7ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 3], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:40:07.827609"], ["updated_at", "2023-11-07 23:40:07.827609"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(with_zero_amount)
---------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[31mDELETE FROM "transactions";
INSERT INTO "transactions" ("id", "transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES (980190962, 1, 1, 1, '434505******9116', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-07 23:40:23.238005', '2023-11-07 23:40:23.238005'), (298486374, 2, 1, 1, '444456******4210', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-07 23:40:23.238005', '2023-11-07 23:40:23.238005')[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.8ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(without_a_required_attribute)
---------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(without_duplicated_transaction_ID)
--------------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 3], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:40:23.301259"], ["updated_at", "2023-11-07 23:40:23.301259"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(with_future_transaction_date)
---------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(with_zero_amount)
---------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(with_negative_amount)
-------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
TransactionTest: test_should_set_the_has_cbk_after_creation
-----------------------------------------------------------
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 3], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:40:23.337003"], ["updated_at", "2023-11-07 23:40:23.337003"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
TransactionTest: test_should_persist_a_valid_transaction
--------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 3], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:40:23.348153"], ["updated_at", "2023-11-07 23:40:23.348153"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[31mDELETE FROM "transactions";
INSERT INTO "transactions" ("id", "transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES (980190962, 1, 1, 1, '434505******9116', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-07 23:41:15.843397', '2023-11-07 23:41:15.843397'), (298486374, 2, 1, 1, '444456******4210', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-07 23:41:15.843397', '2023-11-07 23:41:15.843397')[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.7ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
TransactionTest: test_should_set_the_has_cbk_after_creation
-----------------------------------------------------------
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 3], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:41:15.927263"], ["updated_at", "2023-11-07 23:41:15.927263"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(with_negative_amount)
-------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(without_a_required_attribute)
---------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(with_future_transaction_date)
---------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(without_duplicated_transaction_ID)
--------------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.2ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 3], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:41:15.945072"], ["updated_at", "2023-11-07 23:41:15.945072"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(with_zero_amount)
---------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
TransactionTest: test_should_persist_a_valid_transaction
--------------------------------------------------------
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 3], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.5ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 3], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:41:15.957313"], ["updated_at", "2023-11-07 23:41:15.957313"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[31mDELETE FROM "transactions";
INSERT INTO "transactions" ("id", "transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES (980190962, 1, 1, 1, '434505******9116', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-07 23:42:03.330988', '2023-11-07 23:42:03.330988'), (298486374, 2, 1, 1, '444456******4210', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-07 23:42:03.330988', '2023-11-07 23:42:03.330988')[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.7ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(without_duplicated_transaction_ID)
--------------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(with_zero_amount)
---------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
TransactionTest: test_should_set_the_has_cbk_after_creation
-----------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(without_a_required_attribute)
---------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
TransactionTest: test_should_persist_a_valid_transaction
--------------------------------------------------------
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(with_future_transaction_date)
---------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.5ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_a_invalid_transaction_(with_negative_amount)
-------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.2ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.6ms)[0m  [1m[31mDELETE FROM "transactions";
INSERT INTO "transactions" ("id", "transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES (980190962, 1, 1, 1, '434505******9116', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-07 23:43:49.407088', '2023-11-07 23:43:49.407088'), (298486374, 2, 1, 1, '444456******4210', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-07 23:43:49.407088', '2023-11-07 23:43:49.407088')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.5ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
TransactionTest: test_should_persist_a_valid_transaction
--------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_zero_amount)
----------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_future_transaction_date)
----------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(without_a_required_attribute)
----------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_duplicated_transaction_ID)
------------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
TransactionTest: test_should_set_the_has_cbk_after_creation
-----------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_negative_amount)
--------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.2ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[31mDELETE FROM "transactions";
INSERT INTO "transactions" ("id", "transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES (980190962, 1, 1, 1, '434505******9116', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-07 23:44:10.399710', '2023-11-07 23:44:10.399710'), (298486374, 2, 1, 1, '444456******4210', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-07 23:44:10.399710', '2023-11-07 23:44:10.399710')[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[35mALTER TABLE "transactions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (4.7ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_zero_amount)
----------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 354363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_duplicated_transaction_ID)
------------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 354363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.8ms)[0m  [1m[32mINSERT INTO "transactions" ("id", "transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11) RETURNING "id"[0m  [["id", 980190962], ["transaction_id", 354363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:44:10.399710"], ["updated_at", "2023-11-07 23:44:10.399710"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
TransactionTest: test_should_persist_a_valid_transaction
--------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 354363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.7ms)[0m  [1m[32mINSERT INTO "transactions" ("id", "transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11) RETURNING "id"[0m  [["id", 980190962], ["transaction_id", 354363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:44:10.399710"], ["updated_at", "2023-11-07 23:44:10.399710"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
TransactionTest: test_should_set_the_has_cbk_after_creation
-----------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 354363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.7ms)[0m  [1m[32mINSERT INTO "transactions" ("id", "transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11) RETURNING "id"[0m  [["id", 980190962], ["transaction_id", 354363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:44:10.399710"], ["updated_at", "2023-11-07 23:44:10.399710"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_negative_amount)
--------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 354363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_future_transaction_date)
----------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 354363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(without_a_required_attribute)
----------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.5ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[31mDELETE FROM "transactions";
INSERT INTO "transactions" ("id", "transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES (980190962, 1, 1, 1, '434505******9116', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-07 23:44:38.017818', '2023-11-07 23:44:38.017818'), (298486374, 2, 1, 1, '444456******4210', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-07 23:44:38.017818', '2023-11-07 23:44:38.017818')[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "transactions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (5.0ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_future_transaction_date)
----------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 354363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
TransactionTest: test_should_persist_a_valid_transaction
--------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 354363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 354363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:44:38.017818"], ["updated_at", "2023-11-07 23:44:38.017818"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
TransactionTest: test_should_set_the_has_cbk_after_creation
-----------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 354363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.5ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 354363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:44:38.017818"], ["updated_at", "2023-11-07 23:44:38.017818"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_negative_amount)
--------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 354363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_duplicated_transaction_ID)
------------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 354363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.5ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 354363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:44:38.017818"], ["updated_at", "2023-11-07 23:44:38.017818"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 354363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(without_a_required_attribute)
----------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_zero_amount)
----------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.2ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (2.1ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 354363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "transactions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[31mDELETE FROM "transactions";
INSERT INTO "transactions" ("id", "transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES (822834886, 1, 1, 1, '434505******9116', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-07 23:45:27.688595', '2023-11-07 23:45:27.688595')[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.3ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_zero_amount)
----------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 354363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_duplicated_transaction_ID)
------------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.5ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 354363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 354363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:45:27.688595"], ["updated_at", "2023-11-07 23:45:27.688595"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 354363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
TransactionTest: test_should_set_the_has_cbk_after_creation
-----------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 354363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 354363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:45:27.688595"], ["updated_at", "2023-11-07 23:45:27.688595"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_negative_amount)
--------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 354363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
TransactionTest: test_should_persist_a_valid_transaction
--------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 354363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 354363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:45:27.688595"], ["updated_at", "2023-11-07 23:45:27.688595"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_future_transaction_date)
----------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 354363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(without_a_required_attribute)
----------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.2ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[31mDELETE FROM "transactions";
INSERT INTO "transactions" ("id", "transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES (822834886, 1, 1, 1, '434505******9116', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-07 23:49:20.635231', '2023-11-07 23:49:20.635231')[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "transactions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.6ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_negative_amount)
--------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(without_a_required_attribute)
----------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.5ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_zero_amount)
----------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
TransactionTest: test_should_set_the_has_cbk_after_creation
-----------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 35363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:49:20.635231"], ["updated_at", "2023-11-07 23:49:20.635231"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
TransactionTest: test_should_persist_a_valid_transaction
--------------------------------------------------------
  [1m[36mTransaction Load (0.5ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.3ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 35363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:49:20.635231"], ["updated_at", "2023-11-07 23:49:20.635231"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_future_transaction_date)
----------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_duplicated_transaction_ID)
------------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.2ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 35363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:49:20.635231"], ["updated_at", "2023-11-07 23:49:20.635231"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "transactions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[31mDELETE FROM "transactions";
INSERT INTO "transactions" ("id", "transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES (822834886, 1, 1, 1, '434505******9116', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-07 23:49:49.874053', '2023-11-07 23:49:49.874053')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.3ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
TransactionsControllerTest: test_should_persist_a_valid_transaction
-------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
Started POST "/transactions" for 127.0.0.1 at 2023-11-07 20:49:50 -0300
Processing by TransactionsController#create as JSON
  Parameters: {"transaction"=>{"card_number"=>"434505******9116", "device_id"=>1, "merchant_id"=>1, "transaction_amount"=>1.5, "transaction_date"=>"2023-11-07T15:22:55.000Z", "transaction_id"=>1, "user_id"=>1}}
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Entity in 15ms (Views: 2.3ms | ActiveRecord: 1.2ms | Allocations: 5459)
  [1m[36mTransaction Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[31mDELETE FROM "transactions";
INSERT INTO "transactions" ("id", "transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES (822834886, 1, 1, 1, '434505******9116', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-07 23:50:57.690670', '2023-11-07 23:50:57.690670')[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "transactions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.6ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
TransactionsControllerTest: test_should_persist_a_valid_transaction
-------------------------------------------------------------------
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
Started POST "/transactions" for 127.0.0.1 at 2023-11-07 20:50:57 -0300
Processing by TransactionsController#create as JSON
  Parameters: {"transaction"=>{"card_number"=>"434505******9116", "device_id"=>1, "merchant_id"=>1, "transaction_amount"=>1.5, "transaction_date"=>"2023-11-07T15:22:55.000Z", "transaction_id"=>1, "user_id"=>1}}
Completed 404 Not Found in 0ms (ActiveRecord: 0.0ms | Allocations: 195)
  
AbstractController::ActionNotFound (The show action could not be found for the :set_transaction
callback on TransactionsController, but it is listed in the controller's
:only option.

Raising for missing callback actions is a new default in Rails 7.1, if you'd
like to turn this off you can delete the option from the environment configurations
or set `config.action_controller.raise_on_missing_callback_actions` to `false`.
):
  
test/controllers/transactions_controller_test.rb:10:in `block (2 levels) in <class:TransactionsControllerTest>'
test/controllers/transactions_controller_test.rb:9:in `block in <class:TransactionsControllerTest>'
  [1m[36mCACHE Transaction Count (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[31mDELETE FROM "transactions";
INSERT INTO "transactions" ("id", "transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES (822834886, 1, 1, 1, '434505******9116', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-07 23:52:30.487872', '2023-11-07 23:52:30.487872')[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (4.1ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
TransactionsControllerTest: test_should_persist_a_valid_transaction
-------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
Started POST "/transactions" for 127.0.0.1 at 2023-11-07 20:52:30 -0300
Processing by TransactionsController#create as JSON
  Parameters: {"transaction"=>{"card_number"=>"434505******9116", "device_id"=>1, "merchant_id"=>1, "transaction_amount"=>1.5, "transaction_date"=>"2023-11-07T15:22:55.000Z", "transaction_id"=>1, "user_id"=>1}}
Completed 404 Not Found in 0ms (ActiveRecord: 0.0ms | Allocations: 195)
  
AbstractController::ActionNotFound (The show action could not be found for the :set_transaction
callback on TransactionsController, but it is listed in the controller's
:only option.

Raising for missing callback actions is a new default in Rails 7.1, if you'd
like to turn this off you can delete the option from the environment configurations
or set `config.action_controller.raise_on_missing_callback_actions` to `false`.
):
  
test/controllers/transactions_controller_test.rb:10:in `block (2 levels) in <class:TransactionsControllerTest>'
test/controllers/transactions_controller_test.rb:9:in `block in <class:TransactionsControllerTest>'
  [1m[36mCACHE Transaction Count (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[31mDELETE FROM "transactions";
INSERT INTO "transactions" ("id", "transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES (822834886, 1, 1, 1, '434505******9116', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-07 23:56:09.836720', '2023-11-07 23:56:09.836720')[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.5ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(without_a_required_attribute)
----------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
TransactionTest: test_should_set_the_has_cbk_after_creation
-----------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 35363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:56:09.836720"], ["updated_at", "2023-11-07 23:56:09.836720"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
TransactionTest: test_should_persist_a_valid_transaction
--------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.5ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 35363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:56:09.836720"], ["updated_at", "2023-11-07 23:56:09.836720"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_zero_amount)
----------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_duplicated_transaction_ID)
------------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 35363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:56:09.836720"], ["updated_at", "2023-11-07 23:56:09.836720"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_negative_amount)
--------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_future_transaction_date)
----------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
TransactionsControllerTest: test_should_persist_a_valid_transaction
-------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
Started POST "/transactions" for 127.0.0.1 at 2023-11-07 20:56:10 -0300
Processing by TransactionsController#create as JSON
  Parameters: {"transaction"=>{"card_number"=>"434505******9116", "device_id"=>1, "merchant_id"=>1, "transaction_amount"=>1.5, "transaction_date"=>"2023-11-07T15:22:55.000Z", "transaction_id"=>1, "user_id"=>1}}
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Entity in 14ms (Views: 2.1ms | ActiveRecord: 1.2ms | Allocations: 4944)
  [1m[36mTransaction Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[31mDELETE FROM "transactions";
INSERT INTO "transactions" ("id", "transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES (822834886, 1, 1, 1, '434505******9116', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-07 23:57:56.712694', '2023-11-07 23:57:56.712694')[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (4.1ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------
TransactionsControllerTest: test_should_create_transaction
----------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
Started POST "/transactions" for 127.0.0.1 at 2023-11-07 20:57:56 -0300
Processing by TransactionsController#create as JSON
  Parameters: {"transaction"=>{"card_number"=>"434505******9116", "device_id"=>1, "merchant_id"=>1, "transaction_amount"=>1.5, "transaction_date"=>"2023-11-07T15:22:55.000Z", "transaction_id"=>1, "user_id"=>1}}
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Entity in 14ms (Views: 2.4ms | ActiveRecord: 1.2ms | Allocations: 5420)
  [1m[36mTransaction Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_future_transaction_date)
----------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_zero_amount)
----------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_duplicated_transaction_ID)
------------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (1.1ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.5ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 35363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:57:56.712694"], ["updated_at", "2023-11-07 23:57:56.712694"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(without_a_required_attribute)
----------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
TransactionTest: test_should_set_the_has_cbk_after_creation
-----------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.5ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 35363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:57:56.712694"], ["updated_at", "2023-11-07 23:57:56.712694"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
TransactionTest: test_should_persist_a_valid_transaction
--------------------------------------------------------
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.5ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 35363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:57:56.712694"], ["updated_at", "2023-11-07 23:57:56.712694"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_negative_amount)
--------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.2ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[31mDELETE FROM "transactions";
INSERT INTO "transactions" ("id", "transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES (822834886, 1, 1, 1, '434505******9116', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-07 23:59:04.422430', '2023-11-07 23:59:04.422430')[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (5.1ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(without_a_required_attribute)
----------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_future_transaction_date)
----------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
TransactionTest: test_should_persist_a_valid_transaction
--------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 35363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:59:04.422430"], ["updated_at", "2023-11-07 23:59:04.422430"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_duplicated_transaction_ID)
------------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 35363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:59:04.422430"], ["updated_at", "2023-11-07 23:59:04.422430"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_zero_amount)
----------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_negative_amount)
--------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
TransactionTest: test_should_set_the_has_cbk_after_creation
-----------------------------------------------------------
  [1m[36mTransaction Load (0.2ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 35363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:59:04.422430"], ["updated_at", "2023-11-07 23:59:04.422430"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------
TransactionsControllerTest: test_should_create_transaction
----------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
Started POST "/transactions" for 127.0.0.1 at 2023-11-07 20:59:04 -0300
Processing by TransactionsController#create as JSON
  Parameters: {"transaction"=>{"card_number"=>"434505******9116", "device_id"=>1, "merchant_id"=>1, "transaction_amount"=>1.5, "transaction_date"=>"2023-11-07T15:22:55.000Z", "transaction_id"=>1, "user_id"=>1}}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Entity in 13ms (Views: 2.6ms | ActiveRecord: 1.1ms | Allocations: 4944)
  [1m[36mTransaction Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[31mDELETE FROM "transactions";
INSERT INTO "transactions" ("id", "transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES (822834886, 1, 1, 1, '434505******9116', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-07 23:59:40.456102', '2023-11-07 23:59:40.456102')[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.8ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_future_transaction_date)
----------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_duplicated_transaction_ID)
------------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 35363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:59:40.456102"], ["updated_at", "2023-11-07 23:59:40.456102"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
TransactionTest: test_should_set_the_has_cbk_after_creation
-----------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.6ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 35363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:59:40.456102"], ["updated_at", "2023-11-07 23:59:40.456102"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
TransactionTest: test_should_persist_a_valid_transaction
--------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 35363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:59:40.456102"], ["updated_at", "2023-11-07 23:59:40.456102"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_negative_amount)
--------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_zero_amount)
----------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(without_a_required_attribute)
----------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.2ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------
TransactionsControllerTest: test_should_create_transaction
----------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
Started POST "/transactions" for 127.0.0.1 at 2023-11-07 20:59:40 -0300
Processing by TransactionsController#create as JSON
  Parameters: {"transaction"=>{"card_number"=>"434505******9116", "device_id"=>1, "merchant_id"=>1, "transaction_amount"=>1.5, "transaction_date"=>"2023-11-07T15:22:55.000Z", "transaction_id"=>436356546, "user_id"=>1}}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 436356546], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.5ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 436356546], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-07 23:59:40.697879"], ["updated_at", "2023-11-07 23:59:40.697879"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 12ms (Views: 0.7ms | ActiveRecord: 1.6ms | Allocations: 4166)
  [1m[36mTransaction Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[31mDELETE FROM "transactions";
INSERT INTO "transactions" ("id", "transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES (822834886, 1, 1, 1, '434505******9116', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-08 00:01:13.252165', '2023-11-08 00:01:13.252165')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (4.6ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(without_a_required_attribute)
----------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_duplicated_transaction_ID)
------------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.5ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 35363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-08 00:01:13.252165"], ["updated_at", "2023-11-08 00:01:13.252165"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_future_transaction_date)
----------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_zero_amount)
----------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
TransactionTest: test_should_set_the_has_cbk_after_creation
-----------------------------------------------------------
  [1m[36mTransaction Load (0.5ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 35363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-08 00:01:13.252165"], ["updated_at", "2023-11-08 00:01:13.252165"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_negative_amount)
--------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
TransactionTest: test_should_persist_a_valid_transaction
--------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 35363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-08 00:01:13.252165"], ["updated_at", "2023-11-08 00:01:13.252165"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------
TransactionsControllerTest: test_should_create_transaction
----------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER TABLE "transactions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[31mDELETE FROM "transactions";
INSERT INTO "transactions" ("id", "transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES (822834886, 1, 1, 1, '434505******9116', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-08 00:01:25.424405', '2023-11-08 00:01:25.424405')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "transactions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.4ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------
TransactionsControllerTest: test_should_create_transaction
----------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
Started POST "/transactions" for 127.0.0.1 at 2023-11-07 21:01:25 -0300
Processing by TransactionsController#create as JSON
  Parameters: {"transaction"=>{"id"=>822834886, "transaction_id"=>35363455, "merchant_id"=>1, "user_id"=>1, "card_number"=>"434505******9116", "transaction_date"=>"2023-11-07T15:22:55.000Z", "transaction_amount"=>1.5, "device_id"=>1, "has_cbk"=>false, "created_at"=>"2023-11-08T00:01:25.424Z", "updated_at"=>"2023-11-08T00:01:25.424Z"}}
[31mUnpermitted parameters: :id, :has_cbk, :created_at, :updated_at. Context: { controller: TransactionsController, action: create, request: #<ActionDispatch::Request:0x00007ff279578348>, params: {"transaction"=>{"id"=>822834886, "transaction_id"=>35363455, "merchant_id"=>1, "user_id"=>1, "card_number"=>"434505******9116", "transaction_date"=>"2023-11-07T15:22:55.000Z", "transaction_amount"=>1.5, "device_id"=>1, "has_cbk"=>false, "created_at"=>"2023-11-08T00:01:25.424Z", "updated_at"=>"2023-11-08T00:01:25.424Z"}, "controller"=>"transactions", "action"=>"create"} }[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 35363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-08 00:01:25.607497"], ["updated_at", "2023-11-08 00:01:25.607497"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 15ms (Views: 0.6ms | ActiveRecord: 1.5ms | Allocations: 4981)
  [1m[36mTransaction Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_duplicated_transaction_ID)
------------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 35363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-08 00:01:25.424405"], ["updated_at", "2023-11-08 00:01:25.424405"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(without_a_required_attribute)
----------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_zero_amount)
----------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
TransactionTest: test_should_persist_a_valid_transaction
--------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 35363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-08 00:01:25.424405"], ["updated_at", "2023-11-08 00:01:25.424405"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_future_transaction_date)
----------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_negative_amount)
--------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.2ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
TransactionTest: test_should_set_the_has_cbk_after_creation
-----------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 35363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-08 00:01:25.424405"], ["updated_at", "2023-11-08 00:01:25.424405"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[31mDELETE FROM "transactions";
INSERT INTO "transactions" ("id", "transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES (822834886, 1, 1, 1, '434505******9116', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-08 00:01:41.869280', '2023-11-08 00:01:41.869280')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "transactions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (4.0ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------
TransactionsControllerTest: test_should_create_transaction
----------------------------------------------------------
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
Started POST "/transactions" for 127.0.0.1 at 2023-11-07 21:01:42 -0300
Processing by TransactionsController#create as JSON
  Parameters: {"transaction"=>{"id"=>822834886, "transaction_id"=>35363455, "merchant_id"=>1, "user_id"=>1, "card_number"=>"434505******9116", "transaction_date"=>"2023-11-07T15:22:55.000Z", "transaction_amount"=>1.5, "device_id"=>1, "has_cbk"=>false, "created_at"=>"2023-11-08T00:01:41.869Z", "updated_at"=>"2023-11-08T00:01:41.869Z"}}
[31mUnpermitted parameters: :id, :has_cbk, :created_at, :updated_at. Context: { controller: TransactionsController, action: create, request: #<ActionDispatch::Request:0x00007f10019d8498>, params: {"transaction"=>{"id"=>822834886, "transaction_id"=>35363455, "merchant_id"=>1, "user_id"=>1, "card_number"=>"434505******9116", "transaction_date"=>"2023-11-07T15:22:55.000Z", "transaction_amount"=>1.5, "device_id"=>1, "has_cbk"=>false, "created_at"=>"2023-11-08T00:01:41.869Z", "updated_at"=>"2023-11-08T00:01:41.869Z"}, "controller"=>"transactions", "action"=>"create"} }[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 35363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-08 00:01:42.070768"], ["updated_at", "2023-11-08 00:01:42.070768"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 15ms (Views: 0.7ms | ActiveRecord: 1.7ms | Allocations: 4981)
  [1m[36mTransaction Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
TransactionTest: test_should_persist_a_valid_transaction
--------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 35363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-08 00:01:41.869280"], ["updated_at", "2023-11-08 00:01:41.869280"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_future_transaction_date)
----------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_duplicated_transaction_ID)
------------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 35363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-08 00:01:41.869280"], ["updated_at", "2023-11-08 00:01:41.869280"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_negative_amount)
--------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(without_a_required_attribute)
----------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_zero_amount)
----------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.2ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
TransactionTest: test_should_set_the_has_cbk_after_creation
-----------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 35363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-08 00:01:41.869280"], ["updated_at", "2023-11-08 00:01:41.869280"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[31mDELETE FROM "transactions";
INSERT INTO "transactions" ("id", "transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES (822834886, 1, 1, 1, '434505******9116', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-08 00:03:57.987641', '2023-11-08 00:03:57.987641')[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.6ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
TransactionTest: test_should_persist_a_valid_transaction
--------------------------------------------------------
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.5ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 35363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-08 00:03:57.987641"], ["updated_at", "2023-11-08 00:03:57.987641"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_future_transaction_date)
----------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(without_a_required_attribute)
----------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
TransactionTest: test_should_set_the_has_cbk_after_creation
-----------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 35363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-08 00:03:57.987641"], ["updated_at", "2023-11-08 00:03:57.987641"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_zero_amount)
----------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.5ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_duplicated_transaction_ID)
------------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 35363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-08 00:03:57.987641"], ["updated_at", "2023-11-08 00:03:57.987641"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_negative_amount)
--------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------
TransactionsControllerTest: test_should_create_transaction
----------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
Started POST "/transactions" for 127.0.0.1 at 2023-11-07 21:03:58 -0300
Processing by TransactionsController#create as JSON
  Parameters: {"transaction"=>{"id"=>822834886, "transaction_id"=>35363455, "merchant_id"=>1, "user_id"=>1, "card_number"=>"434505******9116", "transaction_date"=>"2023-11-07T15:22:55.000Z", "transaction_amount"=>1.5, "device_id"=>1, "has_cbk"=>false, "created_at"=>"2023-11-08T00:03:57.987Z", "updated_at"=>"2023-11-08T00:03:57.987Z"}}
[31mUnpermitted parameters: :id, :has_cbk, :created_at, :updated_at. Context: { controller: TransactionsController, action: create, request: #<ActionDispatch::Request:0x00007fcd0f622a80>, params: {"transaction"=>{"id"=>822834886, "transaction_id"=>35363455, "merchant_id"=>1, "user_id"=>1, "card_number"=>"434505******9116", "transaction_date"=>"2023-11-07T15:22:55.000Z", "transaction_amount"=>1.5, "device_id"=>1, "has_cbk"=>false, "created_at"=>"2023-11-08T00:03:57.987Z", "updated_at"=>"2023-11-08T00:03:57.987Z"}, "controller"=>"transactions", "action"=>"create"} }[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 35363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-08 00:03:58.214291"], ["updated_at", "2023-11-08 00:03:58.214291"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 13ms (Views: 0.6ms | ActiveRecord: 1.5ms | Allocations: 4261)
  [1m[36mTransaction Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[31mDELETE FROM "transactions";
INSERT INTO "transactions" ("id", "transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES (822834886, 1, 1, 1, '434505******9116', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-08 00:05:32.633976', '2023-11-08 00:05:32.633976')[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.3ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
TransactionsControllerTest: test_should_persist_a_valid_transaction
-------------------------------------------------------------------
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
Started POST "/transactions" for 127.0.0.1 at 2023-11-07 21:05:32 -0300
Processing by TransactionsController#create as JSON
  Parameters: {"transaction"=>{"id"=>822834886, "transaction_id"=>35363455, "merchant_id"=>1, "user_id"=>1, "card_number"=>"434505******9116", "transaction_date"=>"2023-11-07T15:22:55.000Z", "transaction_amount"=>1.5, "device_id"=>1, "has_cbk"=>false, "created_at"=>"2023-11-08T00:05:32.633Z", "updated_at"=>"2023-11-08T00:05:32.633Z"}}
[31mUnpermitted parameters: :id, :has_cbk, :created_at, :updated_at. Context: { controller: TransactionsController, action: create, request: #<ActionDispatch::Request:0x00007f0f781b83f0>, params: {"transaction"=>{"id"=>822834886, "transaction_id"=>35363455, "merchant_id"=>1, "user_id"=>1, "card_number"=>"434505******9116", "transaction_date"=>"2023-11-07T15:22:55.000Z", "transaction_amount"=>1.5, "device_id"=>1, "has_cbk"=>false, "created_at"=>"2023-11-08T00:05:32.633Z", "updated_at"=>"2023-11-08T00:05:32.633Z"}, "controller"=>"transactions", "action"=>"create"} }[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 35363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-08 00:05:32.825414"], ["updated_at", "2023-11-08 00:05:32.825414"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 15ms (Views: 0.6ms | ActiveRecord: 1.5ms | Allocations: 4980)
  [1m[36mTransaction Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------------------------------
TransactionsControllerTest: test_should_not_persist_an_invalid_transaction_(without_a_required_attribute)
---------------------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
TransactionTest: test_should_persist_a_valid_transaction
--------------------------------------------------------
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 35363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-08 00:05:32.633976"], ["updated_at", "2023-11-08 00:05:32.633976"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(without_a_required_attribute)
----------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_future_transaction_date)
----------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_duplicated_transaction_ID)
------------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 35363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-08 00:05:32.633976"], ["updated_at", "2023-11-08 00:05:32.633976"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_negative_amount)
--------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.2ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_zero_amount)
----------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.2ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
TransactionTest: test_should_set_the_has_cbk_after_creation
-----------------------------------------------------------
  [1m[36mTransaction Load (0.2ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 35363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-08 00:05:32.633976"], ["updated_at", "2023-11-08 00:05:32.633976"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[31mDELETE FROM "transactions";
INSERT INTO "transactions" ("id", "transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES (822834886, 1, 1, 1, '434505******9116', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-08 00:05:51.065660', '2023-11-08 00:05:51.065660')[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.5ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------------------------------
TransactionsControllerTest: test_should_not_persist_an_invalid_transaction_(without_a_required_attribute)
---------------------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
Started POST "/transactions" for 127.0.0.1 at 2023-11-07 21:05:51 -0300
Processing by TransactionsController#create as JSON
  Parameters: {"transaction"=>{"id"=>822834886, "transaction_id"=>nil, "merchant_id"=>1, "user_id"=>1, "card_number"=>"434505******9116", "transaction_date"=>"2023-11-07T15:22:55.000Z", "transaction_amount"=>1.5, "device_id"=>1, "has_cbk"=>false, "created_at"=>"2023-11-08T00:05:51.065Z", "updated_at"=>"2023-11-08T00:05:51.065Z"}}
[31mUnpermitted parameters: :id, :has_cbk, :created_at, :updated_at. Context: { controller: TransactionsController, action: create, request: #<ActionDispatch::Request:0x00007f046a208170>, params: {"transaction"=>{"id"=>822834886, "transaction_id"=>nil, "merchant_id"=>1, "user_id"=>1, "card_number"=>"434505******9116", "transaction_date"=>"2023-11-07T15:22:55.000Z", "transaction_amount"=>1.5, "device_id"=>1, "has_cbk"=>false, "created_at"=>"2023-11-08T00:05:51.065Z", "updated_at"=>"2023-11-08T00:05:51.065Z"}, "controller"=>"transactions", "action"=>"create"} }[0m
Completed 422 Unprocessable Entity in 12ms (Views: 2.1ms | ActiveRecord: 0.0ms | Allocations: 5089)
  [1m[36mCACHE Transaction Count (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
TransactionsControllerTest: test_should_persist_a_valid_transaction
-------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
Started POST "/transactions" for 127.0.0.1 at 2023-11-07 21:05:51 -0300
Processing by TransactionsController#create as JSON
  Parameters: {"transaction"=>{"id"=>822834886, "transaction_id"=>35363455, "merchant_id"=>1, "user_id"=>1, "card_number"=>"434505******9116", "transaction_date"=>"2023-11-07T15:22:55.000Z", "transaction_amount"=>1.5, "device_id"=>1, "has_cbk"=>false, "created_at"=>"2023-11-08T00:05:51.065Z", "updated_at"=>"2023-11-08T00:05:51.065Z"}}
[31mUnpermitted parameters: :id, :has_cbk, :created_at, :updated_at. Context: { controller: TransactionsController, action: create, request: #<ActionDispatch::Request:0x00007f046b270328>, params: {"transaction"=>{"id"=>822834886, "transaction_id"=>35363455, "merchant_id"=>1, "user_id"=>1, "card_number"=>"434505******9116", "transaction_date"=>"2023-11-07T15:22:55.000Z", "transaction_amount"=>1.5, "device_id"=>1, "has_cbk"=>false, "created_at"=>"2023-11-08T00:05:51.065Z", "updated_at"=>"2023-11-08T00:05:51.065Z"}, "controller"=>"transactions", "action"=>"create"} }[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 35363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-08 00:05:51.259212"], ["updated_at", "2023-11-08 00:05:51.259212"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 6ms (Views: 0.6ms | ActiveRecord: 1.5ms | Allocations: 1548)
  [1m[36mTransaction Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_duplicated_transaction_ID)
------------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 35363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-08 00:05:51.065660"], ["updated_at", "2023-11-08 00:05:51.065660"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
TransactionTest: test_should_set_the_has_cbk_after_creation
-----------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.5ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 35363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-08 00:05:51.065660"], ["updated_at", "2023-11-08 00:05:51.065660"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_negative_amount)
--------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
TransactionTest: test_should_persist_a_valid_transaction
--------------------------------------------------------
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.5ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 35363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-08 00:05:51.065660"], ["updated_at", "2023-11-08 00:05:51.065660"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_future_transaction_date)
----------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(without_a_required_attribute)
----------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.2ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_zero_amount)
----------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.2ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "transactions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[31mDELETE FROM "transactions";
INSERT INTO "transactions" ("id", "transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES (822834886, 1, 1, 1, '434505******9116', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-08 00:06:17.886582', '2023-11-08 00:06:17.886582')[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.3ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
TransactionsControllerTest: test_should_persist_a_valid_transaction
-------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
Started POST "/transactions" for 127.0.0.1 at 2023-11-07 21:06:18 -0300
Processing by TransactionsController#create as JSON
  Parameters: {"transaction"=>{"id"=>822834886, "transaction_id"=>35363455, "merchant_id"=>1, "user_id"=>1, "card_number"=>"434505******9116", "transaction_date"=>"2023-11-07T15:22:55.000Z", "transaction_amount"=>1.5, "device_id"=>1, "has_cbk"=>false, "created_at"=>"2023-11-08T00:06:17.886Z", "updated_at"=>"2023-11-08T00:06:17.886Z"}}
[31mUnpermitted parameters: :id, :has_cbk, :created_at, :updated_at. Context: { controller: TransactionsController, action: create, request: #<ActionDispatch::Request:0x00007f6d19948030>, params: {"transaction"=>{"id"=>822834886, "transaction_id"=>35363455, "merchant_id"=>1, "user_id"=>1, "card_number"=>"434505******9116", "transaction_date"=>"2023-11-07T15:22:55.000Z", "transaction_amount"=>1.5, "device_id"=>1, "has_cbk"=>false, "created_at"=>"2023-11-08T00:06:17.886Z", "updated_at"=>"2023-11-08T00:06:17.886Z"}, "controller"=>"transactions", "action"=>"create"} }[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 35363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-08 00:06:18.097530"], ["updated_at", "2023-11-08 00:06:18.097530"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 18ms (Views: 0.6ms | ActiveRecord: 1.7ms | Allocations: 4981)
  [1m[36mTransaction Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------------------------------
TransactionsControllerTest: test_should_not_persist_an_invalid_transaction_(without_a_required_attribute)
---------------------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
Started POST "/transactions" for 127.0.0.1 at 2023-11-07 21:06:18 -0300
Processing by TransactionsController#create as JSON
  Parameters: {"transaction"=>{"id"=>822834886, "transaction_id"=>nil, "merchant_id"=>1, "user_id"=>1, "card_number"=>"434505******9116", "transaction_date"=>"2023-11-07T15:22:55.000Z", "transaction_amount"=>1.5, "device_id"=>1, "has_cbk"=>false, "created_at"=>"2023-11-08T00:06:17.886Z", "updated_at"=>"2023-11-08T00:06:17.886Z"}}
[31mUnpermitted parameters: :id, :has_cbk, :created_at, :updated_at. Context: { controller: TransactionsController, action: create, request: #<ActionDispatch::Request:0x00007f6d1a995e60>, params: {"transaction"=>{"id"=>822834886, "transaction_id"=>nil, "merchant_id"=>1, "user_id"=>1, "card_number"=>"434505******9116", "transaction_date"=>"2023-11-07T15:22:55.000Z", "transaction_amount"=>1.5, "device_id"=>1, "has_cbk"=>false, "created_at"=>"2023-11-08T00:06:17.886Z", "updated_at"=>"2023-11-08T00:06:17.886Z"}, "controller"=>"transactions", "action"=>"create"} }[0m
Completed 422 Unprocessable Entity in 4ms (Views: 2.4ms | ActiveRecord: 0.0ms | Allocations: 1663)
  [1m[36mCACHE Transaction Count (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_future_transaction_date)
----------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_duplicated_transaction_ID)
------------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 35363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-08 00:06:17.886582"], ["updated_at", "2023-11-08 00:06:17.886582"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(without_a_required_attribute)
----------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_negative_amount)
--------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
TransactionTest: test_should_persist_a_valid_transaction
--------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.5ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 35363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-08 00:06:17.886582"], ["updated_at", "2023-11-08 00:06:17.886582"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_zero_amount)
----------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
TransactionTest: test_should_set_the_has_cbk_after_creation
-----------------------------------------------------------
  [1m[36mTransaction Load (0.2ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 35363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-08 00:06:17.886582"], ["updated_at", "2023-11-08 00:06:17.886582"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.5ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[31mDELETE FROM "transactions";
INSERT INTO "transactions" ("id", "transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES (822834886, 1, 1, 1, '434505******9116', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-08 00:07:20.595444', '2023-11-08 00:07:20.595444')[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.9ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_negative_amount)
--------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_zero_amount)
----------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
TransactionTest: test_should_persist_a_valid_transaction
--------------------------------------------------------
  [1m[36mTransaction Load (0.2ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 35363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-08 00:07:20.595444"], ["updated_at", "2023-11-08 00:07:20.595444"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_future_transaction_date)
----------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_duplicated_transaction_ID)
------------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.3ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 35363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-08 00:07:20.595444"], ["updated_at", "2023-11-08 00:07:20.595444"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(without_a_required_attribute)
----------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
TransactionTest: test_should_set_the_has_cbk_after_creation
-----------------------------------------------------------
  [1m[36mTransaction Load (0.2ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.6ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 35363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-08 00:07:20.595444"], ["updated_at", "2023-11-08 00:07:20.595444"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
TransactionsControllerTest: test_should_persist_a_valid_transaction
-------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
Started POST "/transactions" for 127.0.0.1 at 2023-11-07 21:07:20 -0300
Processing by TransactionsController#create as JSON
  Parameters: {"transaction"=>{"id"=>822834886, "transaction_id"=>35363455, "merchant_id"=>1, "user_id"=>1, "card_number"=>"434505******9116", "transaction_date"=>"2023-11-07T15:22:55.000Z", "transaction_amount"=>1.5, "device_id"=>1, "has_cbk"=>false, "created_at"=>"2023-11-08T00:07:20.595Z", "updated_at"=>"2023-11-08T00:07:20.595Z"}}
[31mUnpermitted parameters: :id, :has_cbk, :created_at, :updated_at. Context: { controller: TransactionsController, action: create, request: #<ActionDispatch::Request:0x00007f1418724420>, params: {"transaction"=>{"id"=>822834886, "transaction_id"=>35363455, "merchant_id"=>1, "user_id"=>1, "card_number"=>"434505******9116", "transaction_date"=>"2023-11-07T15:22:55.000Z", "transaction_amount"=>1.5, "device_id"=>1, "has_cbk"=>false, "created_at"=>"2023-11-08T00:07:20.595Z", "updated_at"=>"2023-11-08T00:07:20.595Z"}, "controller"=>"transactions", "action"=>"create"} }[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 35363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-08 00:07:20.850923"], ["updated_at", "2023-11-08 00:07:20.850923"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 16ms (Views: 0.8ms | ActiveRecord: 1.6ms | Allocations: 4261)
  [1m[36mTransaction Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------
TransactionsControllerTest: test_should_not_persist_an_invalid_transaction
--------------------------------------------------------------------------
  [1m[36mTransaction Load (0.2ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
Started POST "/transactions" for 127.0.0.1 at 2023-11-07 21:07:20 -0300
Processing by TransactionsController#create as JSON
  Parameters: {"transaction"=>{"id"=>822834886, "transaction_id"=>nil, "merchant_id"=>1, "user_id"=>1, "card_number"=>"434505******9116", "transaction_date"=>"2023-11-07T15:22:55.000Z", "transaction_amount"=>1.5, "device_id"=>1, "has_cbk"=>false, "created_at"=>"2023-11-08T00:07:20.595Z", "updated_at"=>"2023-11-08T00:07:20.595Z"}}
[31mUnpermitted parameters: :id, :has_cbk, :created_at, :updated_at. Context: { controller: TransactionsController, action: create, request: #<ActionDispatch::Request:0x00007f141882bf58>, params: {"transaction"=>{"id"=>822834886, "transaction_id"=>nil, "merchant_id"=>1, "user_id"=>1, "card_number"=>"434505******9116", "transaction_date"=>"2023-11-07T15:22:55.000Z", "transaction_amount"=>1.5, "device_id"=>1, "has_cbk"=>false, "created_at"=>"2023-11-08T00:07:20.595Z", "updated_at"=>"2023-11-08T00:07:20.595Z"}, "controller"=>"transactions", "action"=>"create"} }[0m
Completed 422 Unprocessable Entity in 5ms (Views: 3.0ms | ActiveRecord: 0.0ms | Allocations: 1654)
  [1m[36mCACHE Transaction Count (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[31mDELETE FROM "transactions";
INSERT INTO "transactions" ("id", "transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES (822834886, 1, 1, 1, '434505******9116', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-08 00:19:10.634790', '2023-11-08 00:19:10.634790')[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "transactions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.5ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_zero_amount)
----------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_negative_amount)
--------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
TransactionTest: test_should_set_the_has_cbk_after_creation
-----------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.7ms)[0m  [1m[32mINSERT INTO "transactions" ("id", "transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11) RETURNING "id"[0m  [["id", 822834886], ["transaction_id", 35363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-08 00:19:10.634790"], ["updated_at", "2023-11-08 00:19:10.634790"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
TransactionTest: test_should_persist_a_valid_transaction
--------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.6ms)[0m  [1m[32mINSERT INTO "transactions" ("id", "transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11) RETURNING "id"[0m  [["id", 822834886], ["transaction_id", 35363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-08 00:19:10.634790"], ["updated_at", "2023-11-08 00:19:10.634790"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_duplicated_transaction_ID)
------------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (2.8ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.8ms)[0m  [1m[32mINSERT INTO "transactions" ("id", "transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11) RETURNING "id"[0m  [["id", 822834886], ["transaction_id", 35363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-08 00:19:10.634790"], ["updated_at", "2023-11-08 00:19:10.634790"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(without_a_required_attribute)
----------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_future_transaction_date)
----------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.2ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------
TransactionsControllerTest: test_should_not_persist_an_invalid_transaction
--------------------------------------------------------------------------
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
Started POST "/transactions" for 127.0.0.1 at 2023-11-07 21:19:10 -0300
Processing by TransactionsController#create as JSON
  Parameters: {"transaction"=>{"id"=>822834886, "transaction_id"=>nil, "merchant_id"=>1, "user_id"=>1, "card_number"=>"434505******9116", "transaction_date"=>"2023-11-07T15:22:55.000Z", "transaction_amount"=>1.5, "device_id"=>1, "has_cbk"=>false, "created_at"=>"2023-11-08T00:19:10.634Z", "updated_at"=>"2023-11-08T00:19:10.634Z"}}
[31mUnpermitted parameters: :id, :has_cbk, :created_at, :updated_at. Context: { controller: TransactionsController, action: create, request: #<ActionDispatch::Request:0x00007f41e1bec448>, params: {"transaction"=>{"id"=>822834886, "transaction_id"=>nil, "merchant_id"=>1, "user_id"=>1, "card_number"=>"434505******9116", "transaction_date"=>"2023-11-07T15:22:55.000Z", "transaction_amount"=>1.5, "device_id"=>1, "has_cbk"=>false, "created_at"=>"2023-11-08T00:19:10.634Z", "updated_at"=>"2023-11-08T00:19:10.634Z"}, "controller"=>"transactions", "action"=>"create"} }[0m
Completed 422 Unprocessable Entity in 12ms (Views: 2.4ms | ActiveRecord: 0.0ms | Allocations: 4707)
  [1m[36mCACHE Transaction Count (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
TransactionsControllerTest: test_should_persist_a_valid_transaction
-------------------------------------------------------------------
  [1m[36mTransaction Load (0.2ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
Started POST "/transactions" for 127.0.0.1 at 2023-11-07 21:19:10 -0300
Processing by TransactionsController#create as JSON
  Parameters: {"transaction"=>{"id"=>822834886, "transaction_id"=>35363455, "merchant_id"=>1, "user_id"=>1, "card_number"=>"434505******9116", "transaction_date"=>"2023-11-07T15:22:55.000Z", "transaction_amount"=>1.5, "device_id"=>1, "has_cbk"=>false, "created_at"=>"2023-11-08T00:19:10.634Z", "updated_at"=>"2023-11-08T00:19:10.634Z"}}
[31mUnpermitted parameters: :id, :has_cbk, :created_at, :updated_at. Context: { controller: TransactionsController, action: create, request: #<ActionDispatch::Request:0x00007f41e31750a8>, params: {"transaction"=>{"id"=>822834886, "transaction_id"=>35363455, "merchant_id"=>1, "user_id"=>1, "card_number"=>"434505******9116", "transaction_date"=>"2023-11-07T15:22:55.000Z", "transaction_amount"=>1.5, "device_id"=>1, "has_cbk"=>false, "created_at"=>"2023-11-08T00:19:10.634Z", "updated_at"=>"2023-11-08T00:19:10.634Z"}, "controller"=>"transactions", "action"=>"create"} }[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 35363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-08 00:19:10.872119"], ["updated_at", "2023-11-08 00:19:10.872119"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 4ms (Views: 0.5ms | ActiveRecord: 1.5ms | Allocations: 1221)
  [1m[36mTransaction Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[31mDELETE FROM "transactions";
INSERT INTO "transactions" ("id", "transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES (822834886, 1, 1, 1, '434505******9116', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-08 00:19:19.355271', '2023-11-08 00:19:19.355271')[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.3ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_zero_amount)
----------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.5ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_duplicated_transaction_ID)
------------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 35363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-08 00:19:19.355271"], ["updated_at", "2023-11-08 00:19:19.355271"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
TransactionTest: test_should_persist_a_valid_transaction
--------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 35363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-08 00:19:19.355271"], ["updated_at", "2023-11-08 00:19:19.355271"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
TransactionTest: test_should_set_the_has_cbk_after_creation
-----------------------------------------------------------
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 35363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-08 00:19:19.355271"], ["updated_at", "2023-11-08 00:19:19.355271"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(without_a_required_attribute)
----------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_negative_amount)
--------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_future_transaction_date)
----------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.2ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------
TransactionsControllerTest: test_should_not_persist_an_invalid_transaction
--------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
Started POST "/transactions" for 127.0.0.1 at 2023-11-07 21:19:19 -0300
Processing by TransactionsController#create as JSON
  Parameters: {"transaction"=>{"id"=>822834886, "transaction_id"=>nil, "merchant_id"=>1, "user_id"=>1, "card_number"=>"434505******9116", "transaction_date"=>"2023-11-07T15:22:55.000Z", "transaction_amount"=>1.5, "device_id"=>1, "has_cbk"=>false, "created_at"=>"2023-11-08T00:19:19.355Z", "updated_at"=>"2023-11-08T00:19:19.355Z"}}
[31mUnpermitted parameters: :id, :has_cbk, :created_at, :updated_at. Context: { controller: TransactionsController, action: create, request: #<ActionDispatch::Request:0x00007f4c4e271180>, params: {"transaction"=>{"id"=>822834886, "transaction_id"=>nil, "merchant_id"=>1, "user_id"=>1, "card_number"=>"434505******9116", "transaction_date"=>"2023-11-07T15:22:55.000Z", "transaction_amount"=>1.5, "device_id"=>1, "has_cbk"=>false, "created_at"=>"2023-11-08T00:19:19.355Z", "updated_at"=>"2023-11-08T00:19:19.355Z"}, "controller"=>"transactions", "action"=>"create"} }[0m
Completed 422 Unprocessable Entity in 12ms (Views: 2.1ms | ActiveRecord: 0.0ms | Allocations: 4735)
  [1m[36mCACHE Transaction Count (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
TransactionsControllerTest: test_should_persist_a_valid_transaction
-------------------------------------------------------------------
  [1m[36mTransaction Load (0.2ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
Started POST "/transactions" for 127.0.0.1 at 2023-11-07 21:19:19 -0300
Processing by TransactionsController#create as JSON
  Parameters: {"transaction"=>{"id"=>822834886, "transaction_id"=>35363455, "merchant_id"=>1, "user_id"=>1, "card_number"=>"434505******9116", "transaction_date"=>"2023-11-07T15:22:55.000Z", "transaction_amount"=>1.5, "device_id"=>1, "has_cbk"=>false, "created_at"=>"2023-11-08T00:19:19.355Z", "updated_at"=>"2023-11-08T00:19:19.355Z"}}
[31mUnpermitted parameters: :id, :has_cbk, :created_at, :updated_at. Context: { controller: TransactionsController, action: create, request: #<ActionDispatch::Request:0x00007f4c4dcb6f60>, params: {"transaction"=>{"id"=>822834886, "transaction_id"=>35363455, "merchant_id"=>1, "user_id"=>1, "card_number"=>"434505******9116", "transaction_date"=>"2023-11-07T15:22:55.000Z", "transaction_amount"=>1.5, "device_id"=>1, "has_cbk"=>false, "created_at"=>"2023-11-08T00:19:19.355Z", "updated_at"=>"2023-11-08T00:19:19.355Z"}, "controller"=>"transactions", "action"=>"create"} }[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 35363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-08 00:19:19.605930"], ["updated_at", "2023-11-08 00:19:19.605930"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 4ms (Views: 0.5ms | ActiveRecord: 1.4ms | Allocations: 1172)
  [1m[36mTransaction Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "transactions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[31mDELETE FROM "transactions";
INSERT INTO "transactions" ("id", "transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES (822834886, 1, 1, 1, '434505******9116', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-08 00:20:08.247477', '2023-11-08 00:20:08.247477')[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "transactions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.1ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
TransactionsControllerTest: test_should_persist_a_valid_transaction
-------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
Started POST "/transactions" for 127.0.0.1 at 2023-11-07 21:20:08 -0300
Processing by TransactionsController#create as JSON
  Parameters: {"transaction"=>{"id"=>822834886, "transaction_id"=>35363455, "merchant_id"=>1, "user_id"=>1, "card_number"=>"434505******9116", "transaction_date"=>"2023-11-07T15:22:55.000Z", "transaction_amount"=>1.5, "device_id"=>1, "has_cbk"=>false, "created_at"=>"2023-11-08T00:20:08.247Z", "updated_at"=>"2023-11-08T00:20:08.247Z"}}
[31mUnpermitted parameters: :id, :has_cbk, :created_at, :updated_at. Context: { controller: TransactionsController, action: create, request: #<ActionDispatch::Request:0x00007f0d08ea8488>, params: {"transaction"=>{"id"=>822834886, "transaction_id"=>35363455, "merchant_id"=>1, "user_id"=>1, "card_number"=>"434505******9116", "transaction_date"=>"2023-11-07T15:22:55.000Z", "transaction_amount"=>1.5, "device_id"=>1, "has_cbk"=>false, "created_at"=>"2023-11-08T00:20:08.247Z", "updated_at"=>"2023-11-08T00:20:08.247Z"}, "controller"=>"transactions", "action"=>"create"} }[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 35363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-08 00:20:08.458498"], ["updated_at", "2023-11-08 00:20:08.458498"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 15ms (Views: 0.6ms | ActiveRecord: 1.6ms | Allocations: 4980)
  [1m[36mTransaction Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------
TransactionsControllerTest: test_should_not_persist_an_invalid_transaction
--------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
Started POST "/transactions" for 127.0.0.1 at 2023-11-07 21:20:08 -0300
Processing by TransactionsController#create as JSON
  Parameters: {"transaction"=>{"id"=>822834886, "transaction_id"=>nil, "merchant_id"=>1, "user_id"=>1, "card_number"=>"434505******9116", "transaction_date"=>"2023-11-07T15:22:55.000Z", "transaction_amount"=>1.5, "device_id"=>1, "has_cbk"=>false, "created_at"=>"2023-11-08T00:20:08.247Z", "updated_at"=>"2023-11-08T00:20:08.247Z"}}
[31mUnpermitted parameters: :id, :has_cbk, :created_at, :updated_at. Context: { controller: TransactionsController, action: create, request: #<ActionDispatch::Request:0x00007f0d09ee6368>, params: {"transaction"=>{"id"=>822834886, "transaction_id"=>nil, "merchant_id"=>1, "user_id"=>1, "card_number"=>"434505******9116", "transaction_date"=>"2023-11-07T15:22:55.000Z", "transaction_amount"=>1.5, "device_id"=>1, "has_cbk"=>false, "created_at"=>"2023-11-08T00:20:08.247Z", "updated_at"=>"2023-11-08T00:20:08.247Z"}, "controller"=>"transactions", "action"=>"create"} }[0m
Completed 422 Unprocessable Entity in 3ms (Views: 2.0ms | ActiveRecord: 0.0ms | Allocations: 1663)
  [1m[36mCACHE Transaction Count (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_negative_amount)
--------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_zero_amount)
----------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_future_transaction_date)
----------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(without_a_required_attribute)
----------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
TransactionTest: test_should_persist_a_valid_transaction
--------------------------------------------------------
  [1m[36mTransaction Load (0.2ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 35363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-08 00:20:08.247477"], ["updated_at", "2023-11-08 00:20:08.247477"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_duplicated_transaction_ID)
------------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.2ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 35363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-08 00:20:08.247477"], ["updated_at", "2023-11-08 00:20:08.247477"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
TransactionTest: test_should_set_the_has_cbk_after_creation
-----------------------------------------------------------
  [1m[36mTransaction Load (0.2ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 35363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-08 00:20:08.247477"], ["updated_at", "2023-11-08 00:20:08.247477"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (23.9ms)[0m  [1m[35mDROP DATABASE IF EXISTS "cloudwalk_risk_api_test"[0m
  [1m[35m (105.0ms)[0m  [1m[35mCREATE DATABASE "cloudwalk_risk_api_test" ENCODING = 'unicode'[0m
  [1m[35mSQL (0.7ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "transactions" CASCADE[0m
  [1m[35m (7.3ms)[0m  [1m[35mCREATE TABLE "transactions" ("id" bigserial primary key, "transaction_id" integer, "merchant_id" integer, "user_id" integer, "card_number" character varying, "transaction_date" timestamp(6), "transaction_amount" float, "device_id" integer, "has_cbk" boolean, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (2.1ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_transactions_on_transaction_id" ON "transactions" ("transaction_id")[0m
  [1m[35m (4.2ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20231107182255)[0m
  [1m[35m (4.4ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.9ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.9ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2023-11-08 00:25:43.065689', '2023-11-08 00:25:43.065693') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.7ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', '917dd6a09938b315f47170e40c6cfad17242a6ff', '2023-11-08 00:25:43.068989', '2023-11-08 00:25:43.068992') RETURNING "key"[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "transactions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[31mDELETE FROM "transactions";
INSERT INTO "transactions" ("id", "transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES (822834886, 1, 1, 1, '434505******9116', '2023-11-07 15:22:55', 1.5, 1, FALSE, '2023-11-08 00:25:43.170344', '2023-11-08 00:25:43.170344')[0m
  [1m[36mTRANSACTION (12.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "transactions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.7ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_constraint SET convalidated=false WHERE conname = ''%I'' AND connamespace::regnamespace = ''%I''::regnamespace; ALTER TABLE %I.%I VALIDATE CONSTRAINT %I;',
    constraint_name,
    table_schema,
    table_schema,
    table_name,
    constraint_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(without_a_required_attribute)
----------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_negative_amount)
--------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
TransactionTest: test_should_set_the_has_cbk_after_creation
-----------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 35363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-08 00:25:43.170344"], ["updated_at", "2023-11-08 00:25:43.170344"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_future_transaction_date)
----------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.7ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
TransactionTest: test_should_persist_a_valid_transaction
--------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 35363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-08 00:25:43.170344"], ["updated_at", "2023-11-08 00:25:43.170344"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_zero_amount)
----------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.4ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------------
TransactionTest: test_should_not_persist_an_invalid_transaction_(with_duplicated_transaction_ID)
------------------------------------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.5ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 35363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-08 00:25:43.170344"], ["updated_at", "2023-11-08 00:25:43.170344"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
TransactionsControllerTest: test_should_persist_a_valid_transaction
-------------------------------------------------------------------
  [1m[36mTransaction Load (0.3ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
Started POST "/transactions" for 127.0.0.1 at 2023-11-07 21:25:43 -0300
Processing by TransactionsController#create as JSON
  Parameters: {"transaction"=>{"id"=>822834886, "transaction_id"=>35363455, "merchant_id"=>1, "user_id"=>1, "card_number"=>"434505******9116", "transaction_date"=>"2023-11-07T15:22:55.000Z", "transaction_amount"=>1.5, "device_id"=>1, "has_cbk"=>false, "created_at"=>"2023-11-08T00:25:43.170Z", "updated_at"=>"2023-11-08T00:25:43.170Z"}}
[31mUnpermitted parameters: :id, :has_cbk, :created_at, :updated_at. Context: { controller: TransactionsController, action: create, request: #<ActionDispatch::Request:0x00007fcafdd59240>, params: {"transaction"=>{"id"=>822834886, "transaction_id"=>35363455, "merchant_id"=>1, "user_id"=>1, "card_number"=>"434505******9116", "transaction_date"=>"2023-11-07T15:22:55.000Z", "transaction_amount"=>1.5, "device_id"=>1, "has_cbk"=>false, "created_at"=>"2023-11-08T00:25:43.170Z", "updated_at"=>"2023-11-08T00:25:43.170Z"}, "controller"=>"transactions", "action"=>"create"} }[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTransaction Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "transactions" WHERE "transactions"."transaction_id" = $1 LIMIT $2[0m  [["transaction_id", 35363455], ["LIMIT", 1]]
  [1m[36mTransaction Create (0.4ms)[0m  [1m[32mINSERT INTO "transactions" ("transaction_id", "merchant_id", "user_id", "card_number", "transaction_date", "transaction_amount", "device_id", "has_cbk", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["transaction_id", 35363455], ["merchant_id", 1], ["user_id", 1], ["card_number", "434505******9116"], ["transaction_date", "2023-11-07 15:22:55"], ["transaction_amount", 1.5], ["device_id", 1], ["has_cbk", false], ["created_at", "2023-11-08 00:25:43.445240"], ["updated_at", "2023-11-08 00:25:43.445240"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 14ms (Views: 0.7ms | ActiveRecord: 1.5ms | Allocations: 4261)
  [1m[36mTransaction Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------
TransactionsControllerTest: test_should_not_persist_an_invalid_transaction
--------------------------------------------------------------------------
  [1m[36mTransaction Load (0.2ms)[0m  [1m[34mSELECT "transactions".* FROM "transactions" WHERE "transactions"."id" = $1 LIMIT $2[0m  [["id", 822834886], ["LIMIT", 1]]
  [1m[36mTransaction Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
Started POST "/transactions" for 127.0.0.1 at 2023-11-07 21:25:43 -0300
Processing by TransactionsController#create as JSON
  Parameters: {"transaction"=>{"id"=>822834886, "transaction_id"=>nil, "merchant_id"=>1, "user_id"=>1, "card_number"=>"434505******9116", "transaction_date"=>"2023-11-07T15:22:55.000Z", "transaction_amount"=>1.5, "device_id"=>1, "has_cbk"=>false, "created_at"=>"2023-11-08T00:25:43.170Z", "updated_at"=>"2023-11-08T00:25:43.170Z"}}
[31mUnpermitted parameters: :id, :has_cbk, :created_at, :updated_at. Context: { controller: TransactionsController, action: create, request: #<ActionDispatch::Request:0x00007fcafd725e78>, params: {"transaction"=>{"id"=>822834886, "transaction_id"=>nil, "merchant_id"=>1, "user_id"=>1, "card_number"=>"434505******9116", "transaction_date"=>"2023-11-07T15:22:55.000Z", "transaction_amount"=>1.5, "device_id"=>1, "has_cbk"=>false, "created_at"=>"2023-11-08T00:25:43.170Z", "updated_at"=>"2023-11-08T00:25:43.170Z"}, "controller"=>"transactions", "action"=>"create"} }[0m
Completed 422 Unprocessable Entity in 3ms (Views: 2.2ms | ActiveRecord: 0.0ms | Allocations: 1654)
  [1m[36mCACHE Transaction Count (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "transactions"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
